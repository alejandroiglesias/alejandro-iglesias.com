"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var a=[],r=!0,n=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(t){n=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(n)throw i}}return a}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}!function(){$("[data-email]").each((function(t,e){var a=e.getAttribute("data-email").split(",").join("@");$(e).attr("href","mailto:"+a).html(a)}));var t=new Map,e=new ShortUniqueId,a=new URLSearchParams(location.search),r="d9a0aefe-5933-4def-96c8-d5cf113a5052",n={},i=!1;$("main.content").find("h1, h2, h3, h4, h5, h6, p, ul > li, .position").addClass("vala-host").each((function(){var a=e.sequentialUUID();$(this).attr("data-vala-element-id",a),t.set(a,new Map)}));var o=function(t){if(t){var e=document.createElement("style"),a=window.styleNode=document.createTextNode(".mark { background-color: "+t+" !important; }");e.type="text/css",e.appendChild(a),document.head.appendChild(e)}};function l(t){return[].concat(_toConsumableArray(t)).reduce((function(t,e){var a=_slicedToArray(e,2),r=a[0],n=a[1];return t[r]=n,t}),{})}var s=$("body").vala({cls:"mark"},(function(a,r,o,s){if(i){var d=$(this).attr("data-vala-element-id"),c=t.get(d),u=e.randomUUID();c.set(u,{start:o.start,end:o.end,data:{id:u}});var f=Object.values(l(c.entries()));n.highlights=Object.assign({},n.highlights,_defineProperty({},d,f)),h(),s(f)}}));if(a.get("hl"))if((n=JSON.parse(atob(a.get("hl")))).uuid!==r)a.delete("hl"),window.history.replaceState({},"",location.pathname+"?"+a);else{var d=function(e){var a=$(".vala-host[data-vala-element-id="+e+"]"),r=t.get(e);n.highlights[e].forEach((function(t){return r.set(t.data.id,t)})),a.html(s.render(a.text(),Array.from(r.values())))};for(var c in n.highlights)d(c);o(n.color)}var h=function(){a.set("hl",btoa(JSON.stringify(Object.assign(n,{uuid:r})))),window.history.replaceState({},"",location.pathname+"?"+a)};window.enableHighlighting=function(e){e&&e!==n.color&&(n.color=e,o(e),h()),i||(i=!0,$("main.content").addClass("is-marking-enabled"),$("body").on("mouseenter",".mark",(function(t){$(this).css("cursor","pointer")})),$("body").on("mouseup",".mark",(function(e){var a=$(this).closest(".vala-host"),r=a.attr("data-vala-element-id"),i=t.get(r),o=$(this).attr("data-id");i.delete(o),a.html(s.render(a.text(),Array.from(i.values())));var d=Object.values(l(i.entries()));d.length?n.highlights[r]=d:delete n.highlights[r],h(),e.stopPropagation()})))}}();